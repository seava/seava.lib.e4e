<project name="DistributionPackageBuilder.pack" default="run" basedir=".">
	<description>Ant task to create distribution package.</description>
	<property file="pack.properties" />

	<target name="run" depends="prepare, download, extract, copy, pack" />

	<target name="download">
		<ant antfile="build-download.xml" />
	</target>

	<target name="extract">
		<ant antfile="build-extract.xml" />
	</target>

	<target name="pack">
		<echo>Building the zip file...</echo>
		<zip destfile="${zipFolder}/seava.e4e-${productVersion}${tag}.zip" basedir="${targetFolder}" />
	</target>


	<target name="prepare">

		<mkdir dir="${tempFolder}" />
		<mkdir dir="${targetFolder}" />
		<mkdir dir="${targetFolder}/build" />
		<mkdir dir="${targetFolder}/demo" />
		<mkdir dir="${targetFolder}/lib" />
		<echo>Cleaning workspace...</echo>
		<echo>Cleaning target folder...</echo>
		<delete dir="${targetFolder}" includeEmptyDirs="true" includes="/**/*">

		</delete>
		<echo>Cleaning temporary folder...</echo>
		<delete includeEmptyDirs="true">
			<fileset dir="${tempFolder}" includes="/**/*" />
		</delete>

		<echo>Creating temporary sub-folder...</echo>
		<mkdir dir="${tempFolder}/core" />
		<mkdir dir="${tempFolder}/maven-metadata" />


		<!--
		<copy file="NOTICE" todir="${targetFolder}" />
		
		<echo>Copying documentation folder...</echo>
		<copy todir="${targetFolder}/docs/programmer-guide">
			<fileset dir="${docsFolderPG}" includes="htmlsingle/**,resources/**" />
		</copy>
		-->
	</target>


	<target name="copy">

		<echo>Copying license files...</echo>
		<get src="http://www.apache.org/licenses/LICENSE-2.0.txt" dest="${targetFolder}/LICENSE" />
		<get src="https://raw.github.com/seava/seava.e4e/master/seava.e4e/NOTICE" dest="${targetFolder}/NOTICE" />

		<echo>Copying artifacts...</echo>
		<copy todir="${targetFolder}/build">
			<fileset dir="${tempFolder}/core" />
		</copy>

		<echo>Copying module artifacts to the build/artifacts folder...</echo>
		<copy todir="${targetFolder}/lib">
			<fileset dir="${tempFolder}/no-version-bundles/seava.e4e.extjs/webapp/js" />
			<fileset dir="${tempFolder}/no-version-bundles/seava.e4e.extjs/webapp" includes="s.gif" />
		</copy>
		<copy todir="${targetFolder}/lib">
			<fileset dir="${tempFolder}/no-version-bundles/seava.e4e.impl/webapp/js" includes="*-extend.js" />
			<fileset dir="${tempFolder}/no-version-bundles/seava.e4e.impl/webapp/js" includes="e4e-*.js, globals.js" />
		</copy>
		<copy todir="${targetFolder}/lib/i18n">
			<fileset dir="${tempFolder}/no-version-bundles/seava.e4e.i18n" />
		</copy>

		<copy todir="${targetFolder}/lib/theme">
			<fileset dir="${tempFolder}/no-version-bundles/seava.e4e.theme" />
		</copy>

		<copy todir="${targetFolder}/demo">
			<fileset dir="${tempFolder}/no-version-bundles/seava.e4e.demo" excludes="index-dev.html" />
		</copy>

	</target>


	<!-- 
	<target name="publish">
		<echo>Uploading to server...</echo>
		<ftp server="${ftpServer}" userid="${ftpUser}" password="${ftpPassword}" passive="yes" remotedir="${ftpPath}" verbose="yes">
			<fileset dir="${targetFolder}">
				<include name="dnet_ebs-${productVersion}${tag}.zip" />
			</fileset>
		</ftp>
	</target>

	-->

</project>